🚀 Starting Salon CRM Backend Server...
🌍 Environment: development
🔗 CORS Origins: [ 'http://localhost:3000', 'http://127.0.0.1:3000' ]
🗄️ MongoDB URI: Not set
🔑 JWT Secret: Not set
(node:20997) [MONGOOSE] Warning: Duplicate schema index on {"phone":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:20997) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(node:20997) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
🚀 Salon CRM Backend running on port 3001
📊 Health check: http://localhost:3001/api/health
🔐 API Base: http://localhost:3001/api
MongoDB Connected: localhost
⏰ Inactivity checker scheduled to run daily at 2 AM IST
📥 Incoming GET /health
::1 - - [11/Oct/2025:01:22:18 +0000] "GET /health HTTP/1.1" 404 43 "-" "curl/8.7.1"
📥 Incoming GET /api/admin/profile
🔗 Connecting to main database: salon_crm_main
(node:20997) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(node:20997) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
✅ Connected to main database: salon_crm_main
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT verification error: TokenExpiredError: jwt expired
    at /Users/shubhamanand/salon-crm/backend/node_modules/jsonwebtoken/verify.js:190:21
    at getSecret (/Users/shubhamanand/salon-crm/backend/node_modules/jsonwebtoken/verify.js:97:14)
    at module.exports [as verify] (/Users/shubhamanand/salon-crm/backend/node_modules/jsonwebtoken/verify.js:101:10)
    at authenticateToken (/Users/shubhamanand/salon-crm/backend/middleware/auth.js:26:7)
    at Layer.handle [as handle_request] (/Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/layer.js:95:5)
    at /Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/index.js:284:15
    at router.process_params (/Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/index.js:346:12) {
  expiredAt: 2025-10-10T21:05:29.000Z
}
::1 - - [11/Oct/2025:01:22:33 +0000] "GET /api/auth/profile HTTP/1.1" 403 52 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:22:33 +0000] "GET /api/admin/profile HTTP/1.1" 200 709 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/auth/login
::1 - - [11/Oct/2025:01:22:49 +0000] "POST /api/auth/login HTTP/1.1" 200 2545881 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/reports/dashboard
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔗 Connecting to database: salon_crm_68db3d367d2a8df8f4023d6e
✅ Connected to business database: salon_crm_68db3d367d2a8df8f4023d6e
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
(node:20997) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(node:20997) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Dashboard stats request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/settings/business HTTP/1.1" 200 785 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
Total services: 5
✅ Sales found: 34
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/sales HTTP/1.1" 200 33735 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/appointments?limit=200&date=2025-10-11 HTTP/1.1" 200 87 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total products: 6
✅ Services found: 5
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/services HTTP/1.1" 200 1326 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/appointments?limit=5 HTTP/1.1" 200 1229 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total staff: 1
✅ Products found: 6
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/products HTTP/1.1" 200 2262 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/settings/payment HTTP/1.1" 200 144 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
Total clients: 4
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
Total appointments: 2
Total receipts: 0
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
Total revenue: 0
✅ Dashboard stats calculated for business: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/reports/dashboard HTTP/1.1" 200 150 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/appointments?limit=500 HTTP/1.1" 200 1231 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/appointments?limit=200&date=2025-10-11 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
✅ Services found: 5
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/reports/dashboard
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Dashboard stats request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total services: 5
✅ Products found: 6
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total products: 6
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/appointments?limit=5 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total staff: 1
Total clients: 4
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/appointments?limit=500 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total appointments: 2
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
Total receipts: 0
Total revenue: 0
✅ Dashboard stats calculated for business: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/reports/dashboard HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 34
::1 - - [11/Oct/2025:01:22:49 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 25,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-10T01:46:41.940Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 25
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Services found: 5
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Products found: 6
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/staff-directory HTTP/1.1" 200 4266 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 25,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-10T01:46:41.940Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 25
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
✅ Services found: 5
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Products found: 6
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:22:54 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:22:58 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:23:00 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:23:00 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 200 179 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:23:06 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:23:08 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:23:09 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:24:44 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:24:44 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:24:54 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:24:55 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:06 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:06 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:32 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:34 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:34 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 No token found in request
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/clients HTTP/1.1" 401 49 "-" "axios/1.11.0"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/admin/profile
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/admin/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/auth/profile HTTP/1.1" 200 2545633 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 25,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-10T01:46:41.940Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 25
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📊 Total clients found: 4
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
✅ Services found: 5
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Products found: 6
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📋 Clients returned: 4
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 25,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-10T01:46:41.940Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 25
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Services found: 5
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Products found: 6
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:25:46 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:47 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:25:47 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:47 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:50 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:51 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:52 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:25:52 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:26:40 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:26:40 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:27:59 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:00 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/sales/68e86581a0d6a0129a6ce3dd/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:19 +0000] "POST /api/sales/68e86581a0d6a0129a6ce3dd/payment HTTP/1.1" 200 1431 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:19 +0000] "GET /api/sales/68e86581a0d6a0129a6ce3dd/payment-summary HTTP/1.1" 200 278 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:19 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 200 3698 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:19 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:27 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 34
::1 - - [11/Oct/2025:01:28:33 +0000] "GET /api/sales HTTP/1.1" 200 33952 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:28:33 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:28:33 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [11/Oct/2025:01:28:33 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/unpaid/overdue
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:35 +0000] "GET /api/sales/unpaid/overdue HTTP/1.1" 200 1073 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/unpaid/overdue
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:28:35 +0000] "GET /api/sales/unpaid/overdue HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:28:38 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [11/Oct/2025:01:28:38 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:28:38 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [11/Oct/2025:01:28:38 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/cash-registry
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/cash-registry HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/cash-registry
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/expenses
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/cash-registry HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/expenses?page=1&limit=1000 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/expenses
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/expenses?page=1&limit=1000 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 34
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 34
::1 - - [11/Oct/2025:01:30:48 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:30:51 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [11/Oct/2025:01:30:51 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760145769,
  exp: 1760232169
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [11/Oct/2025:01:30:51 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [11/Oct/2025:01:30:51 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/auth/logout
🔍 AuthenticateToken middleware called
🔍 No token found in request
::1 - - [12/Oct/2025:03:25:44 +0000] "POST /api/auth/logout HTTP/1.1" 401 49 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/admin/profile
Admin auth error: TokenExpiredError: jwt expired
    at /Users/shubhamanand/salon-crm/backend/node_modules/jsonwebtoken/verify.js:190:21
    at getSecret (/Users/shubhamanand/salon-crm/backend/node_modules/jsonwebtoken/verify.js:97:14)
    at module.exports [as verify] (/Users/shubhamanand/salon-crm/backend/node_modules/jsonwebtoken/verify.js:101:10)
    at authenticateAdmin (/Users/shubhamanand/salon-crm/backend/routes/admin.js:22:25)
    at Layer.handle [as handle_request] (/Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/shubhamanand/salon-crm/backend/node_modules/express/lib/router/route.js:149:13)
    at setupMainDatabase (/Users/shubhamanand/salon-crm/backend/middleware/business-db.js:73:5)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  expiredAt: 2025-10-11T11:43:22.000Z
}
::1 - - [12/Oct/2025:03:25:45 +0000] "GET /api/admin/profile HTTP/1.1" 401 41 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/auth/logout
🔍 AuthenticateToken middleware called
🔍 No token found in request
::1 - - [12/Oct/2025:04:27:00 +0000] "POST /api/auth/logout HTTP/1.1" 401 49 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/auth/logout
🔍 AuthenticateToken middleware called
🔍 No token found in request
::1 - - [12/Oct/2025:04:27:00 +0000] "POST /api/auth/logout HTTP/1.1" 401 49 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/auth/logout
🔍 AuthenticateToken middleware called
🔍 No token found in request
::1 - - [12/Oct/2025:06:25:46 +0000] "POST /api/auth/logout HTTP/1.1" 401 49 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/auth/login
::1 - - [12/Oct/2025:14:21:16 +0000] "POST /api/auth/login HTTP/1.1" 200 2545881 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/reports/dashboard
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Dashboard stats request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total services: 5
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/appointments?limit=200&date=2025-10-12 HTTP/1.1" 200 87 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total products: 6
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
✅ Sales found: 34
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total staff: 1
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
✅ Products found: 6
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total clients: 4
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
Total appointments: 2
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
Total receipts: 0
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/appointments?limit=5 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total revenue: 0
✅ Dashboard stats calculated for business: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/reports/dashboard HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Services found: 5
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:21:16 +0000] "GET /api/appointments?limit=500 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/reports/dashboard
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Dashboard stats request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/appointments?limit=200&date=2025-10-12 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Products found: 6
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total services: 5
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
Total products: 6
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
Total staff: 1
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/appointments?limit=5 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total clients: 4
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
Total appointments: 2
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
Total receipts: 0
✅ Services found: 5
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total revenue: 0
✅ Dashboard stats calculated for business: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/reports/dashboard HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/appointments?limit=500 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 34
::1 - - [12/Oct/2025:14:21:17 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📊 Total clients found: 4
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📋 Clients returned: 4
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Products found: 6
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Services found: 5
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/staff-directory HTTP/1.1" 200 4266 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 25,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-10T01:46:41.940Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 25
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Products found: 6
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
✅ Services found: 5
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 25,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-10T01:46:41.940Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 25
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:31 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:45 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:46 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:46 +0000] "GET /api/appointments?limit=100 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [12/Oct/2025:14:24:46 +0000] "GET /api/appointments?limit=100 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/reports/dashboard
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Dashboard stats request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
Total services: 5
Total products: 6
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/appointments?limit=200&date=2025-10-12 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
✅ Sales found: 34
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total staff: 1
Total clients: 4
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/appointments?limit=500 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total appointments: 2
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
Total receipts: 0
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
Total revenue: 0
✅ Dashboard stats calculated for business: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/reports/dashboard HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Services found: 5
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Products found: 6
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/reports/dashboard
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Dashboard stats request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/appointments?limit=5 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/appointments?limit=200&date=2025-10-12 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total services: 5
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
Total products: 6
✅ Services found: 5
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
Total staff: 1
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/appointments?limit=500 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total clients: 4
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
Total appointments: 2
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Sales found: 34
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total receipts: 0
✅ Products found: 6
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
Total revenue: 0
✅ Dashboard stats calculated for business: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/reports/dashboard HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/appointments?limit=5 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 34
::1 - - [12/Oct/2025:14:24:51 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:10 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
::1 - - [12/Oct/2025:14:25:10 +0000] "GET /api/appointments?limit=100 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:10 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:25:10 +0000] "GET /api/appointments?limit=100 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📊 Total clients found: 4
::1 - - [12/Oct/2025:14:25:12 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:12 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [12/Oct/2025:14:25:12 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📋 Clients returned: 4
::1 - - [12/Oct/2025:14:25:12 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:12 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [12/Oct/2025:14:25:12 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [12/Oct/2025:14:25:12 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:54 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:54 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:56 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:25:56 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:26:21 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760278876,
  exp: 1760365276
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [12/Oct/2025:14:26:21 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
