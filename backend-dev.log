
> salon-crm-backend@1.0.0 dev
> nodemon server.js

[33m[nodemon] 3.1.10[39m
[33m[nodemon] to restart at any time, enter `rs`[39m
[33m[nodemon] watching path(s): *.*[39m
[33m[nodemon] watching extensions: js,mjs,cjs,json[39m
[32m[nodemon] starting `node server.js`[39m
🚀 Starting Salon CRM Backend Server...
🌍 Environment: development
🔗 CORS Origins: [ 'http://localhost:3000', 'http://127.0.0.1:3000' ]
🗄️ MongoDB URI: Not set
🔑 JWT Secret: Not set
(node:80216) [MONGOOSE] Warning: Duplicate schema index on {"phone":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:80216) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(node:80216) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
🚀 Salon CRM Backend running on port 3001
📊 Health check: http://localhost:3001/api/health
🔐 API Base: http://localhost:3001/api
MongoDB Connected: localhost
⏰ Inactivity checker scheduled to run daily at 2 AM IST
[32m[nodemon] restarting due to changes...[39m
[32m[nodemon] starting `node server.js`[39m
🚀 Starting Salon CRM Backend Server...
🌍 Environment: development
🔗 CORS Origins: [ 'http://localhost:3000', 'http://127.0.0.1:3000' ]
🗄️ MongoDB URI: Not set
🔑 JWT Secret: Not set
(node:80403) [MONGOOSE] Warning: Duplicate schema index on {"phone":1} found. This is often due to declaring an index using both "index: true" and "schema.index()". Please remove the duplicate index definition.
(Use `node --trace-warnings ...` to show where the warning was created)
(node:80403) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(node:80403) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
🚀 Salon CRM Backend running on port 3001
📊 Health check: http://localhost:3001/api/health
🔐 API Base: http://localhost:3001/api
MongoDB Connected: localhost
⏰ Inactivity checker scheduled to run daily at 2 AM IST
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔗 Connecting to main database: salon_crm_main
(node:80403) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(node:80403) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
✅ Connected to main database: salon_crm_main
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔗 Connecting to database: salon_crm_68db3d367d2a8df8f4023d6e
✅ Connected to business database: salon_crm_68db3d367d2a8df8f4023d6e
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
(node:80403) [MONGODB DRIVER] Warning: useNewUrlParser is a deprecated option: useNewUrlParser has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
(node:80403) [MONGODB DRIVER] Warning: useUnifiedTopology is a deprecated option: useUnifiedTopology has no effect since Node.js Driver version 4.0.0 and will be removed in the next major version
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:22 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:22 +0000] "GET /api/sales HTTP/1.1" 200 36279 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:22 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:22 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales/bill/ELEGANT-000027
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:23 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:10:23 +0000] "GET /api/sales/bill/ELEGANT-000027 HTTP/1.1" 200 1022 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales/bill/ELEGANT-000027
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:23 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:10:23 +0000] "GET /api/sales/bill/ELEGANT-000027 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:23 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:23 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales/bill/ELEGANT-000027
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:26 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:10:26 +0000] "GET /api/sales/bill/ELEGANT-000027 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:10:26 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:26 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:26 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:28 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:28 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:28 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:28 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [17/Oct/2025:11:10:29 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:29 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:29 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:29 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:29 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales/bill/ELEGANT-000027
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:30 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:10:30 +0000] "GET /api/sales/bill/ELEGANT-000027 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales/bill/ELEGANT-000027
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:30 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:10:30 +0000] "GET /api/sales/bill/ELEGANT-000027 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:30 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:30 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [17/Oct/2025:11:10:34 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:34 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:10:34 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:34 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales/bill/ELEGANT-000027
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:37 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:37 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:10:37 +0000] "GET /api/sales/bill/ELEGANT-000027 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:37 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:10:37 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:56 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:56 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:56 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 36
::1 - - [17/Oct/2025:11:10:56 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📊 Total clients found: 4
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Services found: 5
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 27,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-17T09:13:54.994Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 27
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Products found: 6
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 27,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-17T09:13:54.994Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 27
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Services found: 5
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Products found: 6
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:10:58 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:10:59 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:10:59 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/client/Shubham
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:11:01 +0000] "GET /api/sales/client/Shubham HTTP/1.1" 200 3728 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/settings/business/increment-receipt
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔢 ===== INCREMENT RECEIPT ENDPOINT CALLED =====
🔢 Increment receipt number request received
👤 User: admin@elegant.com Branch: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
🔍 Atomically incrementing receipt number...
📊 Atomically incremented to: 28
🔍 Checking for duplicate receipt number: ELEGANT-000028
✅ Using incremented receipt number: 28
::1 - - [17/Oct/2025:11:11:21 +0000] "POST /api/settings/business/increment-receipt HTTP/1.1" 200 138 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:21 +0000] "GET /api/settings/business HTTP/1.1" 200 785 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming POST /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales POST request received
📋 Request body: {
  "billNo": "ELEGANT-000028",
  "customerId": "68e717baecc1afec6a8946d6",
  "customerName": "Shubham",
  "customerPhone": "7091140602",
  "items": [
    {
      "serviceId": "68e61959862329bae7e7b48c",
      "productId": null,
      "name": "Hydra Facial",
      "type": "service",
      "quantity": 1,
      "price": 2000,
      "total": 2100,
      "staffId": "68f1ffea04b921bd2e0dfc72",
      "staffName": "Suhani",
      "staffContributions": [
        {
          "staffId": "68f1ffea04b921bd2e0dfc72",
          "staffName": "Suhani",
          "percentage": 100,
          "amount": 2100
        }
      ]
    }
  ],
  "netTotal": 2100,
  "taxAmount": 100,
  "grossTotal": 2100,
  "discount": 0,
  "discountType": "percentage",
  "paymentStatus": {
    "totalAmount": 2100,
    "paidAmount": 2100,
    "remainingAmount": 0,
    "dueDate": "2025-10-17T11:11:21.431Z"
  },
  "status": "completed",
  "paymentMode": "cash",
  "payments": [
    {
      "mode": "Cash",
      "amount": 2100
    }
  ],
  "staffId": "68f1ffea04b921bd2e0dfc72",
  "staffName": "Suhani",
  "notes": "",
  "date": "2025-10-17T11:10:58.620Z",
  "time": "16:41"
}
👤 User: {
  _id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin',
  firstName: 'Shubham',
  lastName: 'Anand',
  mobile: '9999999999',
  avatar: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QLGRXhpZgAATU0AKgAAAAgACAEPAAIAAAAIAAAAbgEQAAIAAAARAAAAdgEaAAUAAAABAAAAiAEbAAUAAAABAAAAkAEoAAMAAAABAAIAAAExAAIAAAAOAAAAmAEyAAIAAAAUAAAApodpAAQAAAABAAAAugAAAABzYW1zdW5nAEdhbGF4eSBTMjMgVWx0cmEAAAAAAEgAAAABAAAASAAAAAFTOTE4QlhYUzZDWEZDADIwMjQ6MDk6MTUgMDk6Mzc6MDgAAB2CmgAFAAAAAQAAAhyCnQAFAAAAAQAAAiSIIgADAAAAAQACAACIJwADAAAAAQAyAACQAAAHAAAABDAyMjCQAwACAAAAFAAAAiyQBAACAAAAFAAAAkCQEAACAAAABwAAAlSQEQACAAAABwAAAlySAQAKAAAAAQAAAmSSAgAFAAAAAQAAAmySAwAKAAAAAQAAAnSSBAAKAAAAAQAAAnySBQAFAAAAAQAAAoSSBwADAAAAAQACAACSCQADAAAAAQAAAACSCgAFAAAAAQAAAoySkAACAAAABDQ2NACSkQACAAAABDQ2NACSkgACAAAABDQ2NACgAAAHAAAABDAxMDCgAgAEAAAAAQAAC7igAwAEAAAAAQAAD6CkAgADAAAAAQAAAACkAwADAAAAAQAAAACkBAAFAAAAAQAAApSkBQADAAAAAQAZAACkBgADAAAAAQAAAACkIAACAAAAIQAAApwAAAAAAAAAAQAAAGQAAAALAAAABTIwMjQ6MDk6MTUgMDk6Mzc6MDgAMjAyNDowOToxNSAwOTozNzowOAArMDU6MzAAACswNTozMAAAAAAAAQAAAGQAAADjAAAAZAAAAe0AAABkAAAAAAAAAAEAAADjAAAAZAAAACEAAAAKAAAAAQAAAAE5OTQ1MDVhM2IwNDk1M2EwMDAwMDAwMDAwMDAwMDAwMAAA/+0AOFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/AABEID6ALuAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2wBDAAICAgICAgMCAgMFAwMDBQYFBQUFBggGBgYGBggKCAgICAgICgoKCgoKCgoMDAwMDAwODg4ODg8PDw8PDw8PDw//2wBDAQICAgQEBAcEBAcQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/3QAEALz/2gAMAwEAAhEDEQA/APyPppPYUbqTPOa85mzGkZFRsKmNRnrS2GkQEUBaeRiko3KYUUuO9JVWEFFFJnnFRYsCM0ClopgFPHSlxRUgIelMqSmNTM2JTxUQOTUq9KfQELRSE4pu6kaIlU4NWlbiqAbJqwpOKaJkX1ank8VTRql3cVRiyNzVduc1MxyaZgGmmJDUWrSjiolGKlU02ULSZFOOKizikAUUUU7hceDmlqOnjpzSaAWo6c1IBmgBw6VIOlM6VJSAeDmlzUdFMCSpAe9QA4qVTkUASnkVGelLSHpSAZRg0U8dKAG4pKkopNAR0uM0pHpQOKljTG9aQipCM03aaRomRU3bU+Pam7RRcbIcGkqbbSbaq5JFUgpdtPC1JoCjtUlAWnbaaIkMIzSbTmnYxRTZDYU0rzUoHFG0UrFJkW2kwal20u0Uh3IwMUtSAelLg0DuR7TShfWpNpo20xNjaXBp2AKWna5LQ0L606gnFFIEgoopCadrFIQr6U2lyaSkykIRTOlSUYpDI6Kkox3oJaG7qYWqQjNREU7kjC1G4U0jFNJFIaY4moGNPJzUTU7FJkZPemYJ5p/Wii4xAMU9RmlCiplWkSxVWpNtOUDpUlO5JH0pu2pSKZSKiIBiloooKCpKjp4oAWkPSkLelNJ70AITio296UnuaTg0AMpQKfRQA3bTakppPagBtOWm9amUUAIM9qfS4NLtp3AbSgc4oIxSUgHYFNopCaAGk5pp6UtFAEdNK1IRTadwG7aUDFLS4NACUU7bxRt9aQDaeBgUYApaACnD6U2n5FACDjrTqTqOKWgkax7U2nNTaBoKeOlMp4OaBjhTwO1IOlTxpmgByLmtGBTmooos1pww0AWoVrTiGKghirSjjqGBKgq7Hmo0SraJSAmTkVYQUxFqdRUtAOphOeKkwaMGmkBCR2qEjFWyKiK0wKbCoSKuMtQlaAKxGKiIqyVphWgCk61VdTWkUqMxZp3GjLZagaPNa5hqMwj0p8xZjNEagKEGtt4qqPFVJgZ4HNTp704pTM4oAuxkVdjIrIWTFWEnxSaEzaQ1IDWWtx71L9pxU2INLIorN+0+9AuqGgNUYpQwFZv2r3phuuahoDWMwFQPOMVltde9U5Lr3oSBmjNMDmsO6YGo5bv3rNmugatMhkUxrOkIqSSfNVGfNVcEhMDNLSAYpauKLQU1qdTSCaUhobSgZoAzT+lZMGAGKUdaTrUlJsQU5elNp46VA0LRRS44zQIac0ypKaR3oGNooooC4YxTcc06igLhRSgZpwGKAAZpaKKBphRRRQDYUUuDTtooFYZRjNP2igdKAsIBTs4pCaD0oGNNGOM0oGRTqBWI6Kdt5o200IjK0bafg0u01YEZGKbUhHrSYFAEeBRtFP20m2gBuM0m2pSBTcYoATpRRRQAUhGRS4PWigBAMUE4paa1ACg5oyKRaQjFADs5paaBinUAOUd6dTVp1ABRRRQAUdaKKAIzTx0oxzS0AKDin1HTxyKAFooooAKKO1FACbRS0UUAFFFFABRRRQAo60+mA4pd1AD88YpKbupNxoAfRTQ1OoAKjqSmEc1UQGEUAU6iqAeOlLTc8U2gB56UyiigVgopQM0hGDQMUUnWiigAooooAKYetOPSmUAFFFKBmgVx46UUUUAgpyim1IOlAwoPNFFAEfSjrRRQAYppHenUUAMAzS7adRQAo60+kAxTgM0gEop+0UYqAGjrT6KKAEIzTKkpjdaAEPTmmE0E1GzUARSGs6bvV12qjL0NVEDJn71lyitWbvWbKK0TJZmPxmoGqxJmq7Yq0Q0V2qu3WrDd6rnrQyUMGRT160lOUd6RomWFORTqatOoHzCHpVdzUx61WetENEDdaZup7VFTYWJOtKOtNUGpAMVm0LYdnjFPAxTQKdSBsHqv15qdqgqrEmlanNdHbcAVzNqeRXSWx6USGjciNTt0qtEeBVjPGKhmqGEd6bUlMPWpKEprHtTqa1CExtNPHFOpMZoQMZTWp5GKaRmiwXIW61GRUxFRnpTC4ymE5p9MPBoJbGMe1NpzdajakxDaYfan0mBQgGUw9akPWmkZquYdhlJjnNOIxTc4piFqWEZeos1btVyazm9C4G5ZLllFdlb/ACoBXLWKfMDXVxAkCvKqy1O+mh7PgVmyfO9aEwIWswnbzWUTSSLcUgB21pRSDIrBiky2avRyHOaGhxZtSt8mayIV3T7vSrxkDJtNSw2pA3gdaS0KepoCQeXismc5Jq9sYVUmQmqiZyRh3PANczIcua29TnEeV71hx/Oc1qiUgZcism5gY8iugCZqN4MjFUpDOV2nODV624qa4tccrVRCUODSbJsbcIyeK1YuKxYJlHWtJJcikUXJJsDApkWTzVbl2rRjUKuKdxjGXPNM5Aq4qUGEEVDZVjDuW2g1hSNya6G+gJHy1gSQsp5qRlRxWto5Cy1lt0q3Yv5cgNO4HrFjKNoretzk1w1jdjCjNdbaTggGuWaNom3KP3dc9cjBJrc8wMuKoTQiTIqYOw2cxPMo4qh5ozxVrUrZo2yKx0ODzXTExZeMoqVJRis9mFPQ1QiaeYVW84VHK1QbhVWA/9D8iNxpwOaZRXnHQSU1qUHNNPWpYJiUmBTtpoIxQmNjT0plSkYphGaaYhtIBTiMUlNspIKKKUDNTYoeOaKb04o3UE3FJxTT1pWHem1SJExzTgcUYNGOKAsJnmkIzS0AdqLlCrgGp1NQgVMq0hMXODUgakK+tMPBqjNoeT3pAc0gJNKBigViQnimg4oJ9aiZqALG7Ipu6qwenBqAsWAc0tRA1IKCGOGO9BpKKtFIcKdTB1qQdaTGOA9aWlxml2+tIBtR1MVqIjFADd2KkV6gPekBpFWLoajrVYMafuNAmianA9qh38UoYUCLAxS7ajU1KOlADSCKSpKXb7VNxkYGadtFPC06gtEO0UbTU1JgUrFIgwKTAqYjFJSGRhc04LTx1p2BQTcZRUh5qOqRLYmMnmlxRRTZAYpQOacOlGRRYaYYFKB6U0t6U4HvSZVx200bRRuoLGi4XEIxSUpOaSmhphRS4pKYBRTttJg0twEppFPwaSloNCAYpNop1FK5aAD0pdtKKdSAZtpKkop3JuQkd6iIxVk1EwFAmVmFRbeaskVHRcRCRTCAanaoiKLloiKim7akYU2gYvSpFaowM0oGKBNFkGng+tQA5p240gsSFqSmZJpM0BceDmlpgOKfQFwqTtigDFO20BzERHpTSM1MRikIzQBBg0lS4NNK0DGUUUUBcKTApaUDNArgBUi9aAKfQMKD0oppPagVxpPrTd3pSHrSUAGaTPNNJzQBmgY4nFLSAAUtAhcZpMUo60+gLjNppdpqXGKcBmgZFtpMCpiMUwigCMj0pAM0+mEmgQHrSUUUDCnbqbRQApOaSiigApyigLViOPNACxpmtCKKkgirTiioAWGKtWGLFRRR4rTjTikwJI0q9GtRxpV1EqAHotW0UUxEq0i0AOVakC05VqTbxQFxgX1pDwafTSOeKAG4zUZHY1JSN0poCBh2quy1aaoSOaLAViKTbUpFJtpAQ7fagLUuDSVLY0RlKjZKsU1qEyyi6VUdM1osRVR8VVwMyRMVSfitOWsyaq5gKrPg00TYqtLJiqjTVQmbaz+9O8/3rB+0Yo+000iDdNzjvSfafesE3Jpv2k0gOg+0+9IbrjrXPm5PY003BPepkBtvd471RkvM96zWlJqIkmpJZbe5JqszlqZRQAUmBS0U0NIKKKK0uUgoooqJDcgox2p4GKWs3ISEAxS0UVIgp46UwVIKBoKKKKBBRRTtpoCw3rSYFLjFFA7jSvpRtp1FAXEAApaOtO2+lADaKXBpKBBSjrSUo60DH0UUUCuFFFFA0IfWgEGkNNoG2SUUgpaACiiigkKKeBxSbeaaY7DaTAqTHFMouDQzHal206inzCG7abTycUzrTTAQgGl6UUUwCmtTqQjNADKQjNOxzijBoAbgUtLgml20ANpwHrSgYpcUAFFPApfagCOlwaXHNOoAYBk0EU+igCOnbadRQAzBp2OlLR1oAKXaacFpaAGEUYNPoqbgR4pQKfRVAFJgUtFADSKTBp9FAEdFOIFNoAQmkB5ptOHpTsA6pKjqTrSAKQnBoJxTKpIdgoooqgaCiimEmgQ+gdaaDTqAJKKZk04ZoHYZRTmFNoEFFFFAmxCM00jFPooJuMAzTgMUtFAgooooLQU/IplFAySjqKjoz2oAXFJS54xSUAFKATSk0oOaAEC+tOoooAKUdaSigCSm7qbRSsBIDmio6MmoAeTioyaCaiZqTARmqFmoZqhZqAGO1U5GqdyarvTQFCSs6UVpyiqEi1omBlyCqjitGRaqMlUmQ0Z571Cwq4y1AwqyGiEDNPopQKAUh+cUbvemtTaEVccW9KicZqTAxmo2q0WmQnpUZx3p7VEetMZKtSAd6gQ1MDik0Sx/SikyKKhkiN0qHNTNUGOc00Sy/a5yK6S27Vz1otdDbdqTLibMR4qznvVaIcVLUM2QpOaSimEmkMfkCo80U0ntQA7pSZFMpCcUCFJ9aaT2pCc0wn0pksCe1RE5pSabSbEJkCmZ70p60h6UNgRmmtTulI3SkAyiiimgGt6U2lPWk6UFoYetJTyBTKpEvcbjmtO1GMVRUdK1bccgVhVehpDc6SxiOAa6q1QEDPWsiwj/AHQrft0xXj1ZanpU0R3EYxiuZu28s4rrJkJrl9Qj+aphIucTNSXaea1rZsjdXPzZQituzcGMVsYmxbo0jjHSunhjGwCsiyRVXdWzC1QzVMgnAQVlzuACa0rpgTWFfPtXbQkJnG6wxkfI7VStmFbFzBvBNZDQPEcitUyLGouCKcQAKz4ZSeKt7807AQypkVjzwENkVvHk1C8YamIwhlKuRXGOtTyWuRWbJEynikM3IJVPIq+svNc1C7JV+J3JyaTYHSRuDUxIC1mQPnvVln4xUlkbAMSaoXECnPFXtwqCQZoAwntQTUa27K2RW6IxS+UKB2IbZ5EIrsbCdiBXOxRjvW/YOiuFNZSRcTqIQzDNWCMVNAYygIocDtWBoYGoRbxXD3KmKQ16ZJFvBzXKahp5YkgVrCZnKJzAk4pjXWwVbksZFzWTc27dK3i0ZtEb3gJ60z7WvrVU2zmk+yPVcwrH/9H8hgDS1KFpCvNea2bsjp+BTSDSjNCQkx1FFFJloKYetPxiikBERmkC81LimUFITApCMc06imTcTFIBzzTqKYgpCO4paKTGgFFOxS7RSHZDMZoC1KBml20wYKtSgAUzpUlUSFRlalxmgDNCYEYHrSlfSngU7ApkMrMKhc1bYVUcUAiHdzTwcUwigGkUy0pqcdKrx9KtKuaZAAZoIxUgWl21aAYBgU9fWl208L61LAUDFOwTRgmn0gE2io2WpaaR3oGiqy1ARzVxhmoWWhlkQPapM8U3GKKSYCbh3pd3vTCcmo8mhGZcR6uIcispWwavRPQxpF6imqQRTqLmiQHiiiiiwCng0HoKTIozU2LEPSmUFqYWpCY+pKrhqfupoglqM0ZzRTJaCiijrQ2JoKKfgUYFFh8oynjNKB6U7bSsNIbS7TTsClosJRI+lFSUmAKLByiAetOxmijpTC4u00lPBzTT1pXKEpDjvQTimk0WGhKUHFMLUbqRZKCKWoQ3rTqaRLHE+lNzRTWp7Ei7hTSaSkIzSbGMNRHgVL7UwrSAiop4Wl247UFkRGabtqcL6U8IKAKwWnbfarOynBaYFbbS7asbaNopAVwvtQVqfb6U0j1oMyHbzUgHekwaeOlAB1qQdKYOtPoAQ8imU4ntTaCkITimk5pWptAXGE0lPwKTbQJsbUgHFGMU8DFAhQMUUUUDCkIzUm0UhFAIhI9abt9KmpMA0FkG32oqUjFNwKAGUU/ApAvrQJgBTwKSpOlBAYpwGKQHFBOaCkB5NNPSlph96BiUhFLRQMZtNJUlG31FAEdKBmnhaXaaAGgYpcVKFqZIs07AQpGTWhFEafFDWlFEKaQDYYa04oqbFHWgiUSK5QjjwavRpTEWrsa1DE0PjWrka0kcdXUjqBCItWlWhUxUwGKBNiBfWnUUwk5pXJFam0E96bupjQNTCM04nNJQURN61ER3qcioyMVYEJGaaVqUr6UmDUsCKgjNSYzTD1qGgIqiY1Ixx0qu5oSKTInNVHapnaqjsKoogkasydquTOKy5noE2Z8561QbNWpW7VUJ71aJuRmmZNPqM1Q0FIaWihg4iAHvS0UoGaiRLEopTwaSpAM84ooooJsFFJS00UFFFPHSnzANAzT6KBSbAKKftFG0VDQDKXB60u30pRSsAmCOadRRRYdwpRSVJSEIBS0UUDuFGKKKATG7aCvpTqKAGgYp1FFAXCkwKWigLiYFGBS0UBcKKKKBBRRRQAhGaTbTqKB3Ciil2mgQlFO202gLDxilyKjooHcUnNJRRQIKKXGKTmgAoxml4xSU0wGYNGDT6KsBMUYFLSEZoAZRS7TSUAFFFHWgBafTNpp4GKACiiigAopw9KTHOKAAClIp3TpRQA3bS45paKACjFKOtPobAbtp1FJkVD1AWmEYNOJplFgCiiiqSAKKZmlBzTAdRRRQAwg9aSpDzTdtADcd6XFOwKXFADQvrTqKQ9KaKQzNFFFWCGljmlBowKCcUALRTd1OoFYKcBTacD2FAWEIx0p3Q0h60oNAxetM20ueaN1AuUbRRRTaEwooopGYUUUUFJBRRRQUFFFFABRRRQAUUUUAFKOtJRQBJSA5paKLkphRRRQUFITig9KZQAu40ZNMJ9KTJqWgHE4qBmp5NQsakBjGoiacxNMoAj61Cwqc47VGwoApSLVN1rSYVUdaqIGY61Tda1WSqzx1QNGRItVmWtV46pyLitDNopEc80U9hTKZAhplSdaYR6UDSFHSmEetSAYpG6Zq0aIptUDH0qeQVTYnNUUTqean61TQnNW16VJLHgU6kAxS0mjNiN0qHvU+M00J81JISNC1GBkVv2/SsW3Xitu2qWaxNaPpTmPakT7tK3WoZsNopDntSNQICe1NpT0FJQwEJplOamHpxQAm6m0uDQRincVhhHemE8VL1qMik0SR0UpGKSkAw5zTSM049aSgCOinEd6b0qkAhPOcU0nNOPIplSUgoxiiimmOwoHetW05cCszgVp6eN0orGtsVDc9C09MxCuggi5rHscKgFbkUgBFeBVlqetSQTxYBNcnfgbjXZznchrjLzJc5opM0mjnbhQTinWkpVwKfKvJqouUfdXWjmludzbXHygVqpLtGa4+xn3ECtxp8LjNKQRLzyhiTmsK+cM+BTpLjaDVT/WfNQmUVzzxUb2+5SMVcjjBOasYAFO4HJzWzwtuXpUaTHODXRzxhgRiudurdkbcBVpktFoODUnasuOQjhqvI4NUSSnpTEtvN6inrycVuWtvlBUydhpGGbEA8CkaAqMYrqTbD0qJ7QEVlc05TkjM0RqVb1e5q1fWWORWA8EinNUhG6s6vTywrAWR04qyk5PWncaZrBs1KOlZiT1cWdSMVNyi+hxVhHKsCKopIp71Y3DFISZ1dnfHaATWwlxvrgo7jZ3rUttQywGaylE0TO2XaRVSaFWNQW05k4rTVOOaxehaRg3NkCDgVx19bEOeK9NkjyK5bUbUcsBWkJGconGCEUvlCrrR03ZWvMZ2P//S/JDBpMYqSivOudBARim1KR2phGDSJ2EopDntS07DTFz+dJRRUDCgjNLjFJQA0AinfWiimA0rim1JRRcBgGafgUmBSgelIAopdppdtBSEBxTxTCMU+mgYVIvNMAzUg4pkDgMUtFP4FO4xlFKaShMhiEZFVnWrVRMKYiky0wLzVhhUYGKAJoxjFXEqkpqyjUAXAM07aKarDFTDpTuBFtpcAVL7Uwe9IBKXHGaSpMcYoAZjjNJSkYpMGgBu2o2WrG31pCtBSZUKimMtWitQuOMUFFM5FRk4qwRULCkjMYuc1bjOKqAEGrKUFRL6NU4aqKGrAap2KJy3pUZagtURNFgH76aZKhJ7mmFqLDTJ91ITUAenbhRYLkm404Gogc09fSkBKCaXrTVNPxmmhMcOlPX1pgGKmUfpQhJigdzTsGnKO9OobGM20u2nU'... 2531867 more characters,
  hasLoginAccess: true,
  allowAppointmentScheduling: true,
  isActive: true,
  permissions: [
    { module: 'dashboard', feature: 'view', enabled: true },
    { module: 'dashboard', feature: 'manage', enabled: true },
    { module: 'appointments', feature: 'view', enabled: true },
    { module: 'appointments', feature: 'create', enabled: true },
    { module: 'appointments', feature: 'edit', enabled: true },
    { module: 'appointments', feature: 'delete', enabled: true },
    { module: 'appointments', feature: 'manage', enabled: true },
    { module: 'clients', feature: 'view', enabled: true },
    { module: 'clients', feature: 'create', enabled: true },
    { module: 'clients', feature: 'edit', enabled: true },
    { module: 'clients', feature: 'delete', enabled: true },
    { module: 'clients', feature: 'manage', enabled: true },
    { module: 'services', feature: 'view', enabled: true },
    { module: 'services', feature: 'create', enabled: true },
    { module: 'services', feature: 'edit', enabled: true },
    { module: 'services', feature: 'delete', enabled: true },
    { module: 'services', feature: 'manage', enabled: true },
    { module: 'products', feature: 'view', enabled: true },
    { module: 'products', feature: 'create', enabled: true },
    { module: 'products', feature: 'edit', enabled: true },
    { module: 'products', feature: 'delete', enabled: true },
    { module: 'products', feature: 'manage', enabled: true },
    { module: 'staff', feature: 'view', enabled: true },
    { module: 'staff', feature: 'create', enabled: true },
    { module: 'staff', feature: 'edit', enabled: true },
    { module: 'staff', feature: 'delete', enabled: true },
    { module: 'staff', feature: 'manage', enabled: true },
    { module: 'sales', feature: 'view', enabled: true },
    { module: 'sales', feature: 'create', enabled: true },
    { module: 'sales', feature: 'edit', enabled: true },
    { module: 'sales', feature: 'delete', enabled: true },
    { module: 'sales', feature: 'manage', enabled: true },
    { module: 'reports', feature: 'view', enabled: true },
    { module: 'reports', feature: 'create', enabled: true },
    { module: 'reports', feature: 'edit', enabled: true },
    { module: 'reports', feature: 'delete', enabled: true },
    { module: 'reports', feature: 'manage', enabled: true },
    { module: 'settings', feature: 'view', enabled: true },
    { module: 'settings', feature: 'create', enabled: true },
    { module: 'settings', feature: 'edit', enabled: true },
    { module: 'settings', feature: 'delete', enabled: true },
    { module: 'settings', feature: 'manage', enabled: true },
    { module: 'payment_settings', feature: 'view', enabled: true },
    { module: 'payment_settings', feature: 'create', enabled: true },
    { module: 'payment_settings', feature: 'edit', enabled: true },
    { module: 'payment_settings', feature: 'delete', enabled: true },
    { module: 'payment_settings', feature: 'manage', enabled: true },
    { module: 'pos_settings', feature: 'view', enabled: true },
    { module: 'pos_settings', feature: 'create', enabled: true },
    { module: 'pos_settings', feature: 'edit', enabled: true },
    { module: 'pos_settings', feature: 'delete', enabled: true },
    { module: 'pos_settings', feature: 'manage', enabled: true },
    { module: 'general_settings', feature: 'view', enabled: true },
    { module: 'general_settings', feature: 'create', enabled: true },
    { module: 'general_settings', feature: 'edit', enabled: true },
    { module: 'general_settings', feature: 'delete', enabled: true },
    { module: 'general_settings', feature: 'manage', enabled: true }
  ],
  specialties: [],
  hourlyRate: undefined,
  commissionRate: undefined,
  notes: undefined,
  commissionProfileIds: [],
  createdAt: 2025-09-30T02:15:18.990Z,
  updatedAt: 2025-10-17T07:51:08.319Z
}
🌐 Request headers: {
  host: 'localhost:3001',
  connection: 'keep-alive',
  'content-length': '845',
  'sec-ch-ua-platform': '"macOS"',
  authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZGIzZDM2N2QyYThkZjhmNDAyM2Q2YyIsImVtYWlsIjoiYWRtaW5AZWxlZ2FudC5jb20iLCJyb2xlIjoiYWRtaW4iLCJpYXQiOjE3NjA2ODc0NjgsImV4cCI6MTc2MDc3Mzg2OH0.n7SqsymEJPFLeAzPyLbf8TKrJml6JLzxZAuc15TFq40',
  'sec-ch-ua': '"Chromium";v="140", "Not=A?Brand";v="24", "Google Chrome";v="140"',
  'sec-ch-ua-mobile': '?0',
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36',
  accept: 'application/json, text/plain, */*',
  dnt: '1',
  'content-type': 'application/json',
  origin: 'http://localhost:3000',
  'sec-fetch-site': 'same-site',
  'sec-fetch-mode': 'cors',
  'sec-fetch-dest': 'empty',
  referer: 'http://localhost:3000/',
  'accept-encoding': 'gzip, deflate, br, zstd',
  'accept-language': 'en-US,en;q=0.9,hi;q=0.8'
}
🌐 Request method: POST
🌐 Request url: /api/sales
✅ Sale created successfully: new ObjectId('68f22459d63c74087dd421dc')
::1 - - [17/Oct/2025:11:11:21 +0000] "POST /api/sales HTTP/1.1" 201 1004 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:22 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:11:22 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:11:22 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:11:22 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 37
::1 - - [17/Oct/2025:11:11:25 +0000] "GET /api/sales HTTP/1.1" 200 37260 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:25 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Sales found: 37
::1 - - [17/Oct/2025:11:11:25 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:25 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/bill/ELEGANT-000028
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [17/Oct/2025:11:11:27 +0000] "GET /api/sales/bill/ELEGANT-000028 HTTP/1.1" 200 1004 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:27 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/sales/bill/ELEGANT-000028
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [17/Oct/2025:11:11:27 +0000] "GET /api/sales/bill/ELEGANT-000028 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:27 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:11:27 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:11:27 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:33 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 37
::1 - - [17/Oct/2025:11:11:33 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/sales
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Sales request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:11:33 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Sales found: 37
::1 - - [17/Oct/2025:11:11:33 +0000] "GET /api/sales HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:14:18 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:14:18 +0000] "GET /api/appointments?limit=100 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/appointments
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:14:18 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:14:18 +0000] "GET /api/appointments?limit=100 HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:14:22 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📊 Total clients found: 4
::1 - - [17/Oct/2025:11:14:22 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:14:22 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:14:22 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:14:22 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [17/Oct/2025:11:14:22 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:14:22 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:17:46 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [17/Oct/2025:11:17:46 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📊 Total clients found: 4
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:17:47 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:17:47 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:17:47 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:17:47 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:17:47 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:17:47 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:17:47 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:22:39 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [17/Oct/2025:11:22:39 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📊 Total clients found: 4
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:22:40 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:22:40 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:22:40 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:22:40 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:22:40 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Services found: 5
::1 - - [17/Oct/2025:11:22:40 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:22:40 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/clients HTTP/1.1" 200 1107 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/auth/profile HTTP/1.1" 200 2545633 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/clients HTTP/1.1" 200 1107 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/auth/profile HTTP/1.1" 200 2545633 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📊 Total clients found: 4
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Services found: 5
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Services found: 5
::1 - - [17/Oct/2025:11:23:10 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:23:11 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:24:43 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:24:43 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:24:43 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📊 Total clients found: 4
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Products found: 6
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 28,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-17T11:11:21.408Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 28
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/pos HTTP/1.1" 200 95 "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Products found: 6
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Services found: 5
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 28,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-17T11:11:21.408Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 28
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:26:43 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 No token found in request
::1 - - [17/Oct/2025:11:31:23 +0000] "GET /api/clients HTTP/1.1" 401 49 "-" "axios/1.11.0"
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
📊 Total clients found: 4
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:31:24 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/auth/profile
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
::1 - - [17/Oct/2025:11:31:24 +0000] "GET /api/auth/profile HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/clients
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Clients API Debug: {
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  userEmail: 'admin@elegant.com',
  query: {},
  database: 'salon_crm_68db3d367d2a8df8f4023d6e'
}
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 28,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-17T11:11:21.408Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 28
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Products found: 6
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📊 Total clients found: 4
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📋 Clients returned: 4
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/clients HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/pos
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/services
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/products
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/staff-directory
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Products request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Services request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
=== POS SETTINGS DEBUG ===
Full settings object: {
  _id: new ObjectId('68db45a939aa5019464c4b7a'),
  name: 'Elegant Beauty Lounge',
  email: 'info@elegantbeauty.com',
  phone: '+91 98765 43212',
  website: 'www.glamoursalon.com',
  description: 'Premium salon and spa services in the heart of the city',
  address: '789 Style Street',
  city: 'Bangalore',
  state: 'Karnataka',
  zipCode: '560001',
  receiptPrefix: 'INV',
  invoicePrefix: 'ELEGANT',
  receiptNumber: 28,
  autoIncrementReceipt: true,
  currency: 'INR',
  taxRate: 8.25,
  processingFee: 2.9,
  enableCurrency: true,
  enableTax: true,
  enableProcessingFees: true,
  socialMedia: '@glamoursalon',
  logo: '',
  gstNumber: '',
  createdAt: 2025-09-30T02:51:21.075Z,
  updatedAt: 2025-10-17T11:11:21.408Z,
  __v: 0,
  autoResetReceipt: false,
  resetFrequency: 'monthly',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
settings.invoicePrefix: ELEGANT
settings.receiptPrefix: INV
settings.receiptNumber: 28
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/pos HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Products found: 6
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/products HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Services found: 5
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/services HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/staff-directory HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
📥 Incoming GET /api/settings/business
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
🔍 Business settings request for user: admin@elegant.com branchId: new ObjectId('68db3d367d2a8df8f4023d6e')
📥 Incoming GET /api/settings/payment
🔍 AuthenticateToken middleware called
🔍 JWT decoded successfully: {
  id: '68db3d367d2a8df8f4023d6c',
  email: 'admin@elegant.com',
  role: 'admin',
  iat: 1760687468,
  exp: 1760773868
}
✅ Business settings found: Elegant Beauty Lounge
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/business HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
🔍 Auth middleware user: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Auth middleware req.user set: {
  id: new ObjectId('68db3d367d2a8df8f4023d6c'),
  email: 'admin@elegant.com',
  branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
  role: 'admin'
}
🔍 Business DB Middleware Debug: {
  user: {
    id: new ObjectId('68db3d367d2a8df8f4023d6c'),
    email: 'admin@elegant.com',
    branchId: new ObjectId('68db3d367d2a8df8f4023d6e'),
    role: 'admin'
  },
  businessId: new ObjectId('68db3d367d2a8df8f4023d6e')
}
🔍 Getting business connection for ID: new ObjectId('68db3d367d2a8df8f4023d6e')
🔍 Business connection obtained: true
🔍 Creating business models...
🔍 Business models created: [
  'Client',
  'Appointment',
  'Sale',
  'Receipt',
  'Product',
  'Service',
  'Staff',
  'CashRegistry',
  'Expense',
  'InventoryTransaction',
  'BusinessSettings',
  'Supplier',
  'Category'
]
✅ Business database setup complete
::1 - - [17/Oct/2025:11:31:25 +0000] "GET /api/settings/payment HTTP/1.1" 304 - "http://localhost:3000/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36"
